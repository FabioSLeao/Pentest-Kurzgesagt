# Local File Inclusion Summary

File Inclusion vulnerabilities are commonly found in poorly written PHP web-applications where the input parameters are not properly sanitized or validated. Therefore it becomes easy for an attacker to capture the passing HTTP Requests, manipulates the URL parameter that accepts a filename and include the malicious files in the web-server.
Open Redirection is itself a minor vulnerability, but, it thus itself can cause major damage to the web-application when integrated with others as with "RCE" or "XSS".


Consider a web-application that accepts a parameter that says **"file=test.php"** via its URL, the server further processes it and displays its content on the application’s screen.

Now the attacker tries to manipulate the filename parameter and calls up a local file or even injects a malicious script or a payload calling it from his own website into that parameter, thus the web-server will process it and executes that particular file which might lead to the following attacks:

 - Code execution on the Web server 
 - Cross-Site Scripting Attacks (XSS)
 - Denial of service (DOS) 
 - Data Manipulation Attacks 
 - Sensitive Information Disclosure

Local file inclusion is the vulnerability in which an attacker tries to trick the web-application by including the files that are already present locally into the server. It arises when a php file contains some php functions such as **“include”, “include_once”, “require”, “require_once”**.
This vulnerability occurs, when a page receives, as input, the path to the file that has to be included and this input is not properly sanitized, allowing directory traversal characters (such as dot-dot-slash) to be injected. Thus, the local file inclusion has “High Severity with a CVSS Score of **8.1**”
### Null Byte
In many scenarios, the basic local file inclusion attack might not work, due to the high-security configurations. Many developers add up a **'.php'** extension into their codes at the end of the required variable before it gets included.Therefore the webserver is interpreting **/etc/passwd** as **/etc/passwd.php**, thus we are not able to access the file. In order to get rid of this .php we try to terminate the variable using the **null byte character (%00)** that will force the php server to ignore everything after that, as soon as it is interpreted.
### Base64 encoded
Sometimes the security configuration is much high and we’re unable to view the contents of the included PHP file. Thus we can still exploit the LFI vulnerability by just using the following PHP function.

> 192.168.0.11/bWAPP/rlfi.php?language=php://filter/read=convert.base64-encode/resource=/etc/passwd

The result should be encoded version of the text.

### Mitigations to File Inclusion Attacks

 - In order to prevent our website from the file inclusion attacks, we need to use the strong input validations i.e. rather allow any file to be included in our web-application we should restrict our input parameter to accept a whitelist of acceptable files and reject all the other inputs that do not strictly conform to specifications.
 - Exclude the directory separators “/” to prevent our web-application from the directory traversal attack which may further lead to the Local File Inclusion attacks.
 - Develop or run the code in the most recent version of the PHP server which is available. And even configure the PHP applications so that it does not use register_globals.

#### Reference

- Source: https://www.hackingarticles.in/comprehensive-guide-to-local-file-inclusion/
- Real case Scenario:
https://hackerone.com/reports/59665

https://hackerone.com/reports/492767

https://hackerone.com/reports/895972
